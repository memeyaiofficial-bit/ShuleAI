<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vowel Valley Safari - Master Vowel Sounds</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(
          135deg,
          #4ecdc4 0%,
          #44a08d 50%,
          #093028 100%
        );
        min-height: 100vh;
        padding: 20px;
        position: relative;
        overflow-x: hidden;
      }

      .valley-background {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: -1;
        opacity: 0.1;
      }

      .vowel-symbol {
        position: absolute;
        font-size: 4rem;
        animation: vowelFloat 8s ease-in-out infinite;
        font-weight: bold;
        color: #ffffff;
      }

      .vowel-symbol:nth-child(1) {
        top: 20%;
        left: 10%;
        animation-delay: 0s;
      }
      .vowel-symbol:nth-child(2) {
        top: 70%;
        right: 15%;
        animation-delay: 2s;
      }
      .vowel-symbol:nth-child(3) {
        bottom: 30%;
        left: 20%;
        animation-delay: 4s;
      }
      .vowel-symbol:nth-child(4) {
        top: 45%;
        right: 25%;
        animation-delay: 1.5s;
      }
      .vowel-symbol:nth-child(5) {
        top: 60%;
        left: 45%;
        animation-delay: 3s;
      }

      @keyframes vowelFloat {
        0%,
        100% {
          transform: translateY(0px) scale(1);
          opacity: 0.6;
        }
        25% {
          transform: translateY(-30px) scale(1.1);
          opacity: 0.8;
        }
        50% {
          transform: translateY(-15px) scale(0.9);
          opacity: 1;
        }
        75% {
          transform: translateY(-25px) scale(1.05);
          opacity: 0.7;
        }
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        position: relative;
      }

      .header {
        text-align: center;
        color: white;
        margin-bottom: 30px;
        animation: valleyEntrance 2s ease-out;
      }

      .header h1 {
        font-size: 3.5rem;
        margin-bottom: 15px;
        text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.4);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
      }

      .header p {
        font-size: 1.3rem;
        opacity: 0.95;
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
      }

      .stats-dashboard {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 20px;
        margin-bottom: 25px;
      }

      .stat-widget {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 25px;
        text-align: center;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .stat-widget::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle,
          rgba(78, 205, 196, 0.1) 0%,
          transparent 50%
        );
        animation: shimmer 3s ease-in-out infinite;
      }

      @keyframes shimmer {
        0%,
        100% {
          transform: rotate(0deg);
        }
        50% {
          transform: rotate(180deg);
        }
      }

      .stat-widget:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
      }

      .stat-icon {
        font-size: 2.5rem;
        margin-bottom: 12px;
        position: relative;
        z-index: 1;
      }

      .stat-label {
        font-size: 0.9rem;
        color: #666;
        margin-bottom: 8px;
        font-weight: 600;
      }

      .stat-value {
        font-size: 1.8rem;
        font-weight: bold;
        color: #4ecdc4;
      }

      .game-container {
        background: rgba(255, 255, 255, 0.96);
        border-radius: 20px;
        padding: 35px;
        margin-bottom: 25px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
        position: relative;
        border: 3px solid #4ecdc4;
      }

      .game-container::before {
        content: "üóª";
        position: absolute;
        top: 15px;
        right: 20px;
        font-size: 2rem;
        opacity: 0.7;
      }

      .vowel-showcase {
        text-align: center;
        background: linear-gradient(135deg, #e0f7fa, #b2ebf2);
        border-radius: 18px;
        padding: 40px;
        margin-bottom: 25px;
        border: 3px solid #00bcd4;
        position: relative;
      }

      .current-vowel {
        font-size: 4rem;
        font-weight: bold;
        color: #006064;
        margin-bottom: 18px;
        text-transform: uppercase;
        letter-spacing: 4px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
      }

      .phonetic-display {
        font-size: 2.2rem;
        color: #00838f;
        margin-bottom: 18px;
        font-family: "Courier New", monospace;
        background: rgba(255, 255, 255, 0.8);
        padding: 12px 25px;
        border-radius: 30px;
        display: inline-block;
        border: 2px solid #26c6da;
      }

      .vowel-context {
        background: #f1f8e9;
        border-radius: 15px;
        padding: 25px;
        margin: 25px 0;
        border: 3px solid #8bc34a;
        position: relative;
      }

      .vowel-context::before {
        content: "üèîÔ∏è";
        position: absolute;
        top: -15px;
        left: 25px;
        background: #f1f8e9;
        padding: 0 15px;
        font-size: 2rem;
      }

      .context-header {
        font-weight: bold;
        color: #558b2f;
        margin-bottom: 15px;
        font-size: 1.3rem;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .context-examples {
        color: #33691e;
        line-height: 1.7;
        font-size: 1.15rem;
        text-align: center;
      }

      .example-word {
        display: inline-block;
        background: rgba(139, 195, 74, 0.2);
        padding: 8px 16px;
        margin: 5px;
        border-radius: 20px;
        font-weight: bold;
        color: #2e7d32;
      }

      .pronunciation-tools {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin: 30px 0;
        flex-wrap: wrap;
      }

      .vowel-btn {
        background: linear-gradient(135deg, #4ecdc4, #44a08d);
        color: white;
        border: none;
        padding: 18px 35px;
        border-radius: 50px;
        font-size: 1.2rem;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
        display: inline-flex;
        align-items: center;
        gap: 12px;
        font-weight: 600;
      }

      .vowel-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(78, 205, 196, 0.4);
      }

      .vowel-btn.recording {
        background: linear-gradient(135deg, #e91e63, #ad1457);
        animation: vowelPulse 1.2s infinite;
      }

      @keyframes vowelPulse {
        0% {
          transform: scale(1);
          box-shadow: 0 0 0 0 rgba(233, 30, 99, 0.7);
        }
        70% {
          transform: scale(1.05);
          box-shadow: 0 0 0 10px rgba(233, 30, 99, 0);
        }
        100% {
          transform: scale(1);
          box-shadow: 0 0 0 0 rgba(233, 30, 99, 0);
        }
      }

      .demo-btn {
        background: linear-gradient(135deg, #8bc34a, #689f38);
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 25px;
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
      }

      .demo-btn:hover {
        background: linear-gradient(135deg, #689f38, #8bc34a);
        transform: translateY(-2px);
      }

      .feedback-zone {
        background: #fff3e0;
        border-radius: 18px;
        padding: 30px;
        margin: 25px 0;
        border-left: 6px solid #ff9800;
        display: none;
        text-align: center;
      }

      .feedback-zone.show {
        display: block;
        animation: vowelReveal 0.6s ease-out;
      }

      @keyframes vowelReveal {
        from {
          opacity: 0;
          transform: scale(0.8) translateY(-30px);
        }
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }

      .feedback-emoji {
        font-size: 4rem;
        margin-bottom: 20px;
        animation: bounce 0.8s ease-in-out;
      }

      .feedback-title {
        font-size: 1.5rem;
        font-weight: bold;
        color: #f57c00;
        margin-bottom: 12px;
      }

      .feedback-message {
        color: #ef6c00;
        line-height: 1.6;
        font-size: 1.1rem;
      }

      .progress-tracker {
        background: rgba(255, 255, 255, 0.9);
        border-radius: 15px;
        padding: 25px;
        margin: 25px 0;
        text-align: center;
      }

      .progress-header {
        font-size: 1.3rem;
        color: #4ecdc4;
        margin-bottom: 18px;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      .progress-container {
        background: #e0e0e0;
        height: 25px;
        border-radius: 15px;
        overflow: hidden;
        margin: 15px 0;
        position: relative;
      }

      .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #4ecdc4, #44a08d, #093028);
        transition: width 0.6s ease;
        border-radius: 15px;
        position: relative;
      }

      .progress-bar::after {
        content: "üóª";
        position: absolute;
        right: -15px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 1.5rem;
      }

      .level-indicator {
        display: inline-block;
        background: linear-gradient(135deg, #4ecdc4, #44a08d);
        color: white;
        padding: 10px 25px;
        border-radius: 25px;
        font-weight: bold;
        margin-top: 15px;
        font-size: 1rem;
      }

      .continue-btn {
        background: linear-gradient(135deg, #ff9800, #f57c00);
        color: white;
        border: none;
        padding: 18px 40px;
        border-radius: 30px;
        font-size: 1.3rem;
        cursor: pointer;
        transition: all 0.3s ease;
        margin: 25px auto;
        display: block;
        font-weight: 600;
      }

      .continue-btn:hover {
        background: linear-gradient(135deg, #f57c00, #ff9800);
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(255, 152, 0, 0.3);
      }

      .vowel-tips {
        background: #fff8e1;
        border-radius: 18px;
        padding: 25px;
        margin-top: 25px;
        border: 3px solid #ffc107;
      }

      .tips-header {
        font-size: 1.3rem;
        color: #f57f17;
        margin-bottom: 18px;
        font-weight: bold;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .tip-card {
        background: rgba(255, 255, 255, 0.8);
        padding: 15px;
        margin: 12px 0;
        border-radius: 10px;
        border-left: 4px solid #ff9800;
        transition: all 0.3s ease;
      }

      .tip-card:hover {
        background: white;
        transform: translateX(5px);
      }

      .home-link {
        position: fixed;
        top: 25px;
        left: 25px;
        background: rgba(255, 255, 255, 0.9);
        border: none;
        padding: 15px 25px;
        border-radius: 30px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        font-weight: 600;
      }

      .home-link:hover {
        background: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      @keyframes valleyEntrance {
        0% {
          transform: scale(0.5) translateY(-100px);
          opacity: 0;
        }
        50% {
          transform: scale(1.1) translateY(-20px);
          opacity: 0.8;
        }
        100% {
          transform: scale(1) translateY(0);
          opacity: 1;
        }
      }

      @keyframes bounce {
        0%,
        20%,
        50%,
        80%,
        100% {
          transform: translateY(0);
        }
        40% {
          transform: translateY(-20px);
        }
        60% {
          transform: translateY(-10px);
        }
      }

      @media (max-width: 768px) {
        .header h1 {
          font-size: 2.5rem;
        }
        .current-vowel {
          font-size: 3rem;
        }
        .stats-dashboard {
          grid-template-columns: repeat(2, 1fr);
        }
        .pronunciation-tools {
          flex-direction: column;
          align-items: center;
        }
        .vowel-symbol {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <button class="home-link" onclick="returnHome()">üè† Home</button>

    <div class="valley-background">
      <div class="vowel-symbol">A</div>
      <div class="vowel-symbol">E</div>
      <div class="vowel-symbol">I</div>
      <div class="vowel-symbol">O</div>
      <div class="vowel-symbol">U</div>
    </div>

    <div class="container">
      <div class="header">
        <h1>üóª Vowel Valley Safari üî§</h1>
        <p>Journey through the valley to master English vowel sounds!</p>
      </div>

      <div class="stats-dashboard">
        <div class="stat-widget">
          <div class="stat-icon">üóª</div>
          <div class="stat-label">Valley Level</div>
          <div class="stat-value" id="valleyLevel">1</div>
        </div>
        <div class="stat-widget">
          <div class="stat-icon">üíé</div>
          <div class="stat-label">Vowel Gems</div>
          <div class="stat-value" id="vowelGems">0</div>
        </div>
        <div class="stat-widget">
          <div class="stat-icon">üî§</div>
          <div class="stat-label">Sounds Mastered</div>
          <div class="stat-value" id="soundsMastered">0</div>
        </div>
        <div class="stat-widget">
          <div class="stat-icon">üéØ</div>
          <div class="stat-label">Precision Rate</div>
          <div class="stat-value" id="precisionRate">0%</div>
        </div>
      </div>

      <div class="game-container">
        <div class="vowel-showcase">
          <div class="current-vowel" id="currentVowel">A</div>
          <div class="phonetic-display" id="phoneticVowel">
            /e…™/ as in "name"
          </div>
          <div class="level-indicator" id="difficultyLevel">
            üåü Basic Valley
          </div>
        </div>

        <div class="vowel-context">
          <div class="context-header">üèîÔ∏è Vowel Examples</div>
          <div class="context-examples" id="vowelExamples">
            <div class="example-word">name</div>
            <div class="example-word">cake</div>
            <div class="example-word">play</div>
            <div class="example-word">day</div>
            <div class="example-word">way</div>
          </div>
        </div>

        <div class="pronunciation-tools">
          <button
            class="vowel-btn"
            id="recordButton"
            onclick="toggleVowelRecording()"
          >
            üé§ Start Vowel Practice
          </button>
          <button class="demo-btn" id="demoButton" onclick="playVowelDemo()">
            üîä Listen to Sound
          </button>
        </div>

        <div class="feedback-zone" id="vowelResults">
          <div class="feedback-emoji" id="resultEmoji">üéâ</div>
          <div class="feedback-title" id="resultTitle">
            Perfect Vowel Sound!
          </div>
          <div class="feedback-message" id="resultMessage">
            You've mastered this vowel sound beautifully!
          </div>
        </div>

        <div class="progress-tracker">
          <div class="progress-header">üóª Valley Journey Progress</div>
          <div class="progress-container">
            <div
              class="progress-bar"
              id="valleyProgress"
              style="width: 0%"
            ></div>
          </div>
          <div id="progressStatus">
            Valley Explorer: 0/15 vowel sounds discovered
          </div>
        </div>

        <button
          class="continue-btn"
          id="continueButton"
          onclick="nextVowelChallenge()"
          style="display: none"
        >
          Next Vowel Sound üî§
        </button>
      </div>

      <div class="vowel-tips">
        <div class="tips-header">üéØ Vowel Mastery Guide</div>
        <div class="tip-card">
          üì¢ <strong>Long Vowels:</strong> Hold the sound longer - like "ee" in
          "tree" or "oo" in "moon"
        </div>
        <div class="tip-card">
          ‚ö° <strong>Short Vowels:</strong> Quick, crisp sounds - like "a" in
          "cat" or "i" in "bit"
        </div>
        <div class="tip-card">
          üîÑ <strong>Diphthongs:</strong> Two vowel sounds gliding together -
          like "oy" in "boy"
        </div>
        <div class="tip-card">
          üéµ <strong>Mouth Position:</strong> Pay attention to how your mouth
          moves for each vowel
        </div>
        <div class="tip-card">
          üèîÔ∏è <strong>Valley Secret:</strong> Practice in front of a mirror to
          see your mouth shape
        </div>
      </div>
    </div>

    <script>
      class VowelValleySafari {
        constructor() {
          this.vowelSounds = [
            {
              vowel: "A",
              phonetic: '/e…™/ as in "name"',
              examples: ["name", "cake", "play", "day", "way"],
              words: ["NAME", "CAKE", "PLAY", "AMAZING", "BREAK"],
              difficulty: "basic",
            },
            {
              vowel: "E",
              phonetic: '/iÀê/ as in "tree"',
              examples: ["tree", "bee", "sea", "key", "free"],
              words: ["TREE", "BEE", "SEE", "BELIEVE", "COMPLETE"],
              difficulty: "basic",
            },
            {
              vowel: "I",
              phonetic: '/a…™/ as in "bike"',
              examples: ["bike", "time", "light", "fly", "sky"],
              words: ["BIKE", "TIME", "LIGHT", "DRIVE", "WRITE"],
              difficulty: "basic",
            },
            {
              vowel: "O",
              phonetic: '/o ä/ as in "home"',
              examples: ["home", "boat", "road", "snow", "grow"],
              words: ["HOME", "BOAT", "ROAD", "TOMORROW", "WINDOW"],
              difficulty: "basic",
            },
            {
              vowel: "U",
              phonetic: '/juÀê/ as in "music"',
              examples: ["music", "cube", "huge", "pure", "cure"],
              words: ["MUSIC", "CUBE", "HUGE", "FUTURE", "COMPUTER"],
              difficulty: "basic",
            },
            {
              vowel: "Short A",
              phonetic: '/√¶/ as in "cat"',
              examples: ["cat", "bat", "hat", "map", "bag"],
              words: ["CAT", "BAT", "HAT", "LAPTOP", "FANTASTIC"],
              difficulty: "intermediate",
            },
            {
              vowel: "Short E",
              phonetic: '/…õ/ as in "bed"',
              examples: ["bed", "red", "head", "bread", "dead"],
              words: ["BED", "RED", "HEAD", "BREAKFAST", "WEATHER"],
              difficulty: "intermediate",
            },
            {
              vowel: "Short I",
              phonetic: '/…™/ as in "bit"',
              examples: ["bit", "sit", "hit", "quick", "big"],
              words: ["BIT", "SIT", "HIT", "DIFFERENT", "BUILDING"],
              difficulty: "intermediate",
            },
            {
              vowel: "Short O",
              phonetic: '/…í/ as in "hot"',
              examples: ["hot", "pot", "lot", "rock", "shop"],
              words: ["HOT", "POT", "LOT", "DOCTOR", "HOSPITAL"],
              difficulty: "intermediate",
            },
            {
              vowel: "Short U",
              phonetic: '/ å/ as in "cup"',
              examples: ["cup", "run", "sun", "bus", "fun"],
              words: ["CUP", "RUN", "SUN", "UNDER", "BEAUTIFUL"],
              difficulty: "intermediate",
            },
            {
              vowel: "OO (long)",
              phonetic: '/uÀê/ as in "moon"',
              examples: ["moon", "food", "cool", "school", "tooth"],
              words: ["MOON", "FOOD", "COOL", "SCHOOLCHILDREN", "AFTERNOON"],
              difficulty: "advanced",
            },
            {
              vowel: "OO (short)",
              phonetic: '/ ä/ as in "book"',
              examples: ["book", "look", "good", "foot", "wood"],
              words: ["BOOK", "LOOK", "GOOD", "FOOTBALL", "UNDERSTAND"],
              difficulty: "advanced",
            },
            {
              vowel: "OY",
              phonetic: '/…î…™/ as in "boy"',
              examples: ["boy", "toy", "joy", "coin", "voice"],
              words: ["BOY", "TOY", "JOY", "CHOICE", "APPOINTMENT"],
              difficulty: "advanced",
            },
            {
              vowel: "OW",
              phonetic: '/a ä/ as in "cow"',
              examples: ["cow", "how", "now", "brown", "town"],
              words: ["COW", "HOW", "NOW", "POWERFUL", "DOWNTOWN"],
              difficulty: "advanced",
            },
            {
              vowel: "ER",
              phonetic: '/…úÀêr/ as in "bird"',
              examples: ["bird", "word", "first", "turn", "learn"],
              words: ["BIRD", "WORD", "FIRST", "BIRTHDAY", "GRANDMOTHER"],
              difficulty: "advanced",
            },
          ];

          this.currentIndex = 0;
          this.vowelGems = 0;
          this.valleyLevel = 1;
          this.soundsMastered = 0;
          this.totalTries = 0;
          this.successfulTries = 0;
          this.isRecording = false;
          this.speechRecognition = null;

          this.initializeVowelValley();
        }

        initializeVowelValley() {
          this.updateValleyDisplay();
          this.setupSpeechTechnology();
          this.loadCurrentVowel();
        }

        setupSpeechTechnology() {
          if (
            "webkitSpeechRecognition" in window ||
            "SpeechRecognition" in window
          ) {
            const SpeechRecognition =
              window.SpeechRecognition || window.webkitSpeechRecognition;
            this.speechRecognition = new SpeechRecognition();
            this.speechRecognition.continuous = false;
            this.speechRecognition.interimResults = false;
            this.speechRecognition.lang = "en-US";

            this.speechRecognition.onresult = (event) => {
              const spokenWord = event.results[0][0].transcript.toUpperCase();
              this.evaluateVowelPronunciation(spokenWord);
            };

            this.speechRecognition.onerror = (event) => {
              console.error("Vowel recognition error:", event.error);
              this.showVowelResults(
                "üóª",
                "Valley Challenge!",
                "The valley winds made it hard to hear. Try again with clearer pronunciation!",
              );
              this.stopVowelRecording();
            };

            this.speechRecognition.onend = () => {
              this.stopVowelRecording();
            };
          } else {
            console.warn(
              "Speech recognition not supported on this valley device",
            );
          }
        }

        loadCurrentVowel() {
          const vowelData = this.vowelSounds[this.currentIndex];
          document.getElementById("currentVowel").textContent = vowelData.vowel;
          document.getElementById("phoneticVowel").textContent =
            vowelData.phonetic;

          // Update examples
          const examplesContainer = document.getElementById("vowelExamples");
          examplesContainer.innerHTML = "";
          vowelData.examples.forEach((example) => {
            const exampleDiv = document.createElement("div");
            exampleDiv.className = "example-word";
            exampleDiv.textContent = example;
            examplesContainer.appendChild(exampleDiv);
          });

          const difficultyLevels = {
            basic: "üåü Basic Valley",
            intermediate: "‚≠ê Mountain Pass",
            advanced: "üèÜ Valley Peak",
          };
          document.getElementById("difficultyLevel").textContent =
            difficultyLevels[vowelData.difficulty] || "üåü Basic Valley";

          document.getElementById("continueButton").style.display = "none";
          document.getElementById("vowelResults").classList.remove("show");
          document.getElementById("demoButton").disabled = false;
        }

        toggleVowelRecording() {
          if (this.isRecording) {
            this.stopVowelRecording();
          } else {
            this.startVowelRecording();
          }
        }

        startVowelRecording() {
          if (this.speechRecognition) {
            this.isRecording = true;
            const recordBtn = document.getElementById("recordButton");
            recordBtn.classList.add("recording");
            recordBtn.innerHTML = "‚èπÔ∏è Stop Recording";

            try {
              this.speechRecognition.start();
            } catch (error) {
              console.error("Error starting vowel recording:", error);
              this.stopVowelRecording();
            }
          }
        }

        stopVowelRecording() {
          this.isRecording = false;
          const recordBtn = document.getElementById("recordButton");
          recordBtn.classList.remove("recording");
          recordBtn.innerHTML = "üé§ Start Vowel Practice";

          if (this.speechRecognition) {
            this.speechRecognition.stop();
          }
        }

        playVowelDemo() {
          const vowelData = this.vowelSounds[this.currentIndex];
          if ("speechSynthesis" in window) {
            // Play the vowel sound by using one of the example words
            const exampleWord = vowelData.examples[0];
            const utterance = new SpeechSynthesisUtterance(exampleWord);
            utterance.rate = 0.6;
            utterance.pitch = 1.2;
            utterance.volume = 1;

            const voices = speechSynthesis.getVoices();
            const preferredVoice =
              voices.find(
                (voice) =>
                  voice.lang.includes("en-US") || voice.lang.includes("en-GB"),
              ) || voices.find((voice) => voice.lang.includes("en"));

            if (preferredVoice) {
              utterance.voice = preferredVoice;
            }

            speechSynthesis.speak(utterance);

            // Also demonstrate the phonetic description
            setTimeout(() => {
              const phoneticUtterance = new SpeechSynthesisUtterance(
                vowelData.phonetic,
              );
              phoneticUtterance.rate = 0.5;
              phoneticUtterance.pitch = 1.0;
              if (preferredVoice) {
                phoneticUtterance.voice = preferredVoice;
              }
              speechSynthesis.speak(phoneticUtterance);
            }, 1500);
          }
        }

        evaluateVowelPronunciation(spokenWord) {
          const vowelData = this.vowelSounds[this.currentIndex];
          const targetWords = vowelData.words;

          this.totalTries++;

          // Check if the spoken word matches any of the target words
          const isMatch = targetWords.some((targetWord) => {
            const similarity = this.calculateWordSimilarity(
              spokenWord,
              targetWord,
            );
            return (
              similarity > 0.6 ||
              spokenWord.includes(targetWord.substring(0, 3)) ||
              targetWord.includes(spokenWord.substring(0, 3))
            );
          });

          // Also check if it matches any of the examples
          const exampleMatch = vowelData.examples.some((example) => {
            const similarity = this.calculateWordSimilarity(
              spokenWord,
              example.toUpperCase(),
            );
            return similarity > 0.6;
          });

          if (isMatch || exampleMatch) {
            this.handleSuccessfulVowel();
          } else {
            // Check for partial matches
            const hasPartialMatch = targetWords.some(
              (word) =>
                spokenWord.includes(word.substring(0, 2)) ||
                word.includes(spokenWord.substring(0, 2)),
            );

            if (hasPartialMatch) {
              this.showVowelResults(
                "üóª",
                "Almost There!",
                `You said "${spokenWord}". You're close! Try focusing on the ${vowelData.vowel} sound.`,
              );
            } else {
              this.showVowelResults(
                "üî§",
                "Keep Exploring!",
                `You said "${spokenWord}". Try saying a word with the ${vowelData.vowel} sound like "${vowelData.examples[0]}".`,
              );
            }
          }
        }

        handleSuccessfulVowel() {
          this.successfulTries++;
          this.vowelGems += 25;
          this.soundsMastered++;

          const vowelAchievements = [
            "üóª Outstanding vowel mastery! You've conquered this sound!",
            "üíé Brilliant pronunciation! You found a vowel gem!",
            "üî§ Perfect vowel sound! Your pronunciation is crystal clear!",
            "üéØ Excellent work! You've mastered this valley challenge!",
            "üèÜ Fantastic! You're becoming a vowel valley expert!",
            "‚≠ê Superb pronunciation! Keep exploring the valley!",
          ];

          const randomAchievement =
            vowelAchievements[
              Math.floor(Math.random() * vowelAchievements.length)
            ];
          this.showVowelResults("üèÜ", "Vowel Mastered!", randomAchievement);

          document.getElementById("continueButton").style.display = "block";

          // Valley level progression
          if (this.soundsMastered % 5 === 0) {
            this.valleyLevel++;
            this.showVowelResults(
              "‚≠ê",
              "Valley Level Up!",
              `Welcome to Valley Level ${this.valleyLevel}! New vowel challenges await!`,
            );
          }

          this.updateValleyDisplay();
        }

        calculateWordSimilarity(word1, word2) {
          const longer = word1.length > word2.length ? word1 : word2;
          const shorter = word1.length > word2.length ? word2 : word1;
          const editDistance = this.computeLevenshteinDistance(longer, shorter);
          return (longer.length - editDistance) / longer.length;
        }

        computeLevenshteinDistance(str1, str2) {
          const matrix = [];
          for (let i = 0; i <= str2.length; i++) {
            matrix[i] = [i];
          }
          for (let j = 0; j <= str1.length; j++) {
            matrix[0][j] = j;
          }
          for (let i = 1; i <= str2.length; i++) {
            for (let j = 1; j <= str1.length; j++) {
              if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                matrix[i][j] = matrix[i - 1][j - 1];
              } else {
                matrix[i][j] = Math.min(
                  matrix[i - 1][j - 1] + 1,
                  matrix[i][j - 1] + 1,
                  matrix[i - 1][j] + 1,
                );
              }
            }
          }
          return matrix[str2.length][str1.length];
        }

        showVowelResults(emoji, title, message) {
          document.getElementById("resultEmoji").textContent = emoji;
          document.getElementById("resultTitle").textContent = title;
          document.getElementById("resultMessage").textContent = message;
          document.getElementById("vowelResults").classList.add("show");
        }

        nextVowelChallenge() {
          this.currentIndex = (this.currentIndex + 1) % this.vowelSounds.length;
          this.loadCurrentVowel();
        }

        updateValleyDisplay() {
          document.getElementById("valleyLevel").textContent = this.valleyLevel;
          document.getElementById("vowelGems").textContent = this.vowelGems;
          document.getElementById("soundsMastered").textContent =
            this.soundsMastered;

          const precision =
            this.totalTries > 0
              ? Math.round((this.successfulTries / this.totalTries) * 100)
              : 0;
          document.getElementById("precisionRate").textContent =
            precision + "%";

          const progress =
            (this.soundsMastered / this.vowelSounds.length) * 100;
          document.getElementById("valleyProgress").style.width =
            progress + "%";
          document.getElementById("progressStatus").textContent =
            `Valley Explorer: ${this.soundsMastered}/${this.vowelSounds.length} vowel sounds discovered`;
        }
      }

      function returnHome() {
        if (
          confirm(
            "Are you sure you want to leave Vowel Valley? Your progress will be saved!",
          )
        ) {
          window.location.href = "../../index.html";
        }
      }

      // Global wrapper functions for HTML onclick events
      function toggleVowelRecording() {
        if (window.vowelGame) {
          window.vowelGame.toggleVowelRecording();
        }
      }

      function playVowelDemo() {
        if (window.vowelGame) {
          window.vowelGame.playVowelDemo();
        }
      }

      function nextVowelChallenge() {
        if (window.vowelGame) {
          window.vowelGame.nextVowelChallenge();
        }
      }

      // Initialize game when page loads
      document.addEventListener("DOMContentLoaded", () => {
        window.vowelGame = new VowelValleySafari();
      });

      // Load voices when they're available
      if ("speechSynthesis" in window) {
        speechSynthesis.onvoiceschanged = () => {
          console.log(
            "Valley voices loaded:",
            speechSynthesis.getVoices().length,
          );
        };
      }
    </script>
  </body>
</html>
